#!/usr/bin/env node
"use strict";var z=Object.create;var u=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var O=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty;var B=(a,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of N(e))!q.call(a,i)&&i!==t&&u(a,i,{get:()=>e[i],enumerable:!(o=A(e,i))||o.enumerable});return a};var p=(a,e,t)=>(t=a!=null?z(O(a)):{},B(e||!a||!a.__esModule?u(t,"default",{value:a,enumerable:!0}):t,a));var m=require("commander"),r=p(require("inquirer"),1),y=require("uuid");var d=require("drizzle-orm");var f=p(require("better-sqlite3"),1),g=require("drizzle-orm/better-sqlite3"),v=require("drizzle-orm/better-sqlite3/migrator"),P=new f.default("db.sqlite"),c=(0,g.drizzle)(P);(0,v.migrate)(c,{migrationsFolder:"./drizzle"});var n=require("drizzle-orm/sqlite-core"),l=(0,n.sqliteTable)("filmes",{id:(0,n.text)("id").primaryKey(),titulo:(0,n.text)("titulo").notNull(),diretor:(0,n.text)("diretor").notNull(),anoLancamento:(0,n.integer)("ano_lancamento").notNull(),genero:(0,n.text)("genero"),nota:(0,n.real)("nota"),dataAssistido:(0,n.text)("data_assistido")});var s=class{static async findAll(){return await c.select().from(l)}static async findById(e){return(await c.select().from(l).where((0,d.eq)(l.id,e)).limit(1))[0]??null}static async create(e){await c.insert(l).values(e)}static async update(e,t){let o=await c.update(l).set(t).where((0,d.eq)(l.id,e)).returning();if(o.length===0)throw new Error("Filme not found");return o[0]}static async delete(e){if((await c.delete(l).where((0,d.eq)(l.id,e)).returning()).length===0)throw new Error("Filme not found")}};async function w(){let a=await s.findAll();if(a.length===0){console.log(`
\u{1F3AC} Nenhum filme cadastrado.`);return}console.log(`
\u{1F3AC} Lista de Filmes:`),console.table(a)}async function D(a){let e=a;if(e||(e=(await r.default.prompt([{type:"input",name:"id",message:"Digite o ID (UUID) do filme:",validate:o=>o?!0:"O ID \xE9 obrigat\xF3rio."}])).id),e){let t=await s.findById(e);t?(console.log(`
\u{1F50E} Filme encontrado:`),console.table([t])):console.error(`
\u274C Filme n\xE3o encontrado com o ID informado.`)}}async function I(){console.log(`
\u2795 Cadastrando um novo filme...`);let a=await r.default.prompt([{type:"input",name:"titulo",message:"T\xEDtulo:",validate:t=>t?!0:"Obrigat\xF3rio."},{type:"input",name:"diretor",message:"Diretor(a):",validate:t=>t?!0:"Obrigat\xF3rio."},{type:"input",name:"anoLancamento",message:"Ano de Lan\xE7amento:",validate:t=>isNaN(parseInt(t))?"Inv\xE1lido.":!0},{type:"input",name:"genero",message:"G\xEAnero (opcional):"},{type:"input",name:"nota",message:"Nota (opcional):"},{type:"input",name:"dataAssistido",message:"Data Assistido (opcional):"}]),e={id:(0,y.v4)(),titulo:a.titulo,diretor:a.diretor,anoLancamento:parseInt(a.anoLancamento),genero:a.genero||null,nota:a.nota?parseFloat(a.nota):null,dataAssistido:a.dataAssistido||null};await s.create(e),console.log(`
\u2705 Filme cadastrado com sucesso!`)}async function F(){let{id:a}=await r.default.prompt([{type:"input",name:"id",message:"Digite o ID do filme para atualizar:",validate:L=>L?!0:"O ID \xE9 obrigat\xF3rio."}]),e=await s.findById(a);if(!e){console.error(`
\u274C Filme n\xE3o encontrado com o ID informado.`);return}console.log(`
\u{1F504} Atualizando filme (pressione Enter para manter o valor atual):`);let t=[{type:"input",name:"titulo",message:"Novo T\xEDtulo:",default:e.titulo},{type:"input",name:"diretor",message:"Novo Diretor(a):",default:e.diretor},{type:"input",name:"anoLancamento",message:"Novo Ano:",default:String(e.anoLancamento)},{type:"input",name:"genero",message:"Novo G\xEAnero:",default:e.genero??""}],o=await r.default.prompt([{type:"input",name:"titulo",message:"T\xEDtulo:"},{type:"input",name:"diretor",message:"Diretor(a):"},{type:"input",name:"anoLancamento",message:"Ano de Lan\xE7amento:"},{type:"input",name:"genero",message:"G\xEAnero (opcional):"}]),i={};o.titulo&&o.titulo!==e.titulo&&(i.titulo=o.titulo),o.diretor&&o.diretor!==e.diretor&&(i.diretor=o.diretor),o.anoLancamento&&parseInt(o.anoLancamento)!==e.anoLancamento&&(i.anoLancamento=parseInt(o.anoLancamento)),o.genero!==e.genero&&(i.genero=o.genero||null),Object.keys(i).length>0?(await s.update(a,i),console.log(`
\u2705 Filme atualizado com sucesso!`)):console.log(`
Nenhuma altera\xE7\xE3o foi feita.`)}async function b(){let{id:a}=await r.default.prompt([{type:"input",name:"id",message:"Digite o ID do filme para deletar:",validate:o=>o?!0:"O ID \xE9 obrigat\xF3rio."}]),e=await s.findById(a);if(!e){console.error(`
\u274C Filme n\xE3o encontrado com o ID informado.`);return}let{confirm:t}=await r.default.prompt([{type:"confirm",name:"confirm",message:`Tem certeza que deseja deletar "${e.titulo}"?`,default:!1}]);t?(await s.delete(a),console.log(`
\u{1F5D1}\uFE0F Filme deletado com sucesso.`)):console.log(`
Opera\xE7\xE3o cancelada.`)}async function h(){console.log(`
\u{1F3AC} Bem-vindo ao Gerenciador de Filmes!`);let a=[{type:"list",name:"action",message:"O que deseja fazer?",choices:[{name:"\u{1F4CB} Listar todos os filmes",value:"listar"},{name:"\u2795 Cadastrar um novo filme",value:"cadastrar"},{name:"\u{1F50D} Buscar um filme por ID",value:"buscar"},{name:"\u{1F504} Atualizar um filme",value:"atualizar"},{name:"\u{1F5D1}\uFE0F Deletar um filme",value:"deletar"},new r.default.Separator,{name:"\u274C Sair",value:"sair"}]}],{action:e}=await r.default.prompt([{type:"list",name:"action",message:"O que deseja fazer?",choices:[{name:"\u{1F4CB} Listar todos os filmes",value:"listar"},{name:"\u2795 Cadastrar um novo filme",value:"cadastrar"},{name:"\u{1F50D} Buscar um filme por ID",value:"buscar"},{name:"\u{1F504} Atualizar um filme",value:"atualizar"},{name:"\u{1F5D1}\uFE0F Deletar um filme",value:"deletar"},new r.default.Separator,{name:"\u274C Sair",value:"sair"}]}]);switch(e){case"listar":await w();break;case"cadastrar":await I();break;case"buscar":await D();break;case"atualizar":await F();break;case"deletar":await b();break;case"sair":console.log(`
\u{1F44B} At\xE9 logo!`),process.exit(0)}let{again:t}=await r.default.prompt([{type:"confirm",name:"again",message:`
Deseja realizar outra opera\xE7\xE3o?`,default:!0}]);t?await h():console.log(`
\u{1F44B} At\xE9 logo!`)}m.program.version("1.0.0").description("Gerenciador de Filmes via CLI");m.program.command("listar").description("Lista todos os filmes").action(w);m.program.command("cadastrar").description("Cadastra um novo filme").action(I);m.program.command("buscar [id]").description("Busca um filme pelo ID (opcional)").action(D);m.program.command("atualizar").description("Atualiza os dados de um filme").action(F);m.program.command("deletar").description("Deleta um filme").action(b);process.argv.length>2?m.program.parse(process.argv):h();
