#!/usr/bin/env node
"use strict";var L=Object.create;var f=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,O=Object.prototype.hasOwnProperty;var P=(a,e,o,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of M(e))!O.call(a,s)&&s!==o&&f(a,s,{get:()=>e[s],enumerable:!(t=N(e,s))||t.enumerable});return a};var g=(a,e,o)=>(o=a!=null?L(q(a)):{},P(e||!a||!a.__esModule?f(o,"default",{value:a,enumerable:!0}):o,a));var d=require("commander"),u=require("date-fns"),n=g(require("inquirer")),v=require("uuid");var p=require("drizzle-orm");var y=g(require("better-sqlite3")),w=require("drizzle-orm/better-sqlite3"),A=require("drizzle-orm/better-sqlite3/migrator"),x=new y.default("db.sqlite"),c=(0,w.drizzle)(x);(0,A.migrate)(c,{migrationsFolder:"./drizzle"});var r=require("drizzle-orm/sqlite-core"),l=(0,r.sqliteTable)("filmes",{id:(0,r.text)("id").primaryKey(),titulo:(0,r.text)("titulo").notNull(),diretor:(0,r.text)("diretor").notNull(),anoLancamento:(0,r.integer)("ano_lancamento").notNull(),genero:(0,r.text)("genero"),nota:(0,r.real)("nota"),dataAssistido:(0,r.text)("data_assistido")});var i=class{static async findAll(){return await c.select().from(l)}static async findById(e){return(await c.select().from(l).where((0,p.eq)(l.id,e)).limit(1))[0]??null}static async create(e){await c.insert(l).values(e)}static async update(e,o){let t=await c.update(l).set(o).where((0,p.eq)(l.id,e)).returning();if(t.length===0)throw new Error("Filme not found");return t[0]}static async delete(e){if((await c.delete(l).where((0,p.eq)(l.id,e)).returning()).length===0)throw new Error("Filme not found")}};async function D(){try{let a=await i.findAll();if(a.length===0){console.log(`
\u{1F3AC} Nenhum filme cadastrado.`);return}console.log(`
\u{1F3AC} Lista de Filmes:`),console.table(a)}catch(a){console.error(`
\u274C Erro ao listar filmes:`,a.message)}}async function h(a){let e=a;if(e||(e=(await n.default.prompt([{type:"input",name:"id",message:"Digite o ID (UUID) do filme:",validate:t=>t?!0:"O ID \xE9 obrigat\xF3rio."}])).id),e)try{let o=await i.findById(e);o?(console.log(`
\u{1F50E} Filme encontrado:`),console.table([o])):console.error(`
\u274C Filme n\xE3o encontrado.`)}catch(o){console.error(`
\u274C Erro ao buscar filme:`,o.message)}}async function F(){try{console.log(`
\u2795 Cadastrando um novo filme...`);let a=[{type:"input",name:"titulo",message:"T\xEDtulo:",validate:t=>t?!0:"Obrigat\xF3rio."},{type:"input",name:"diretor",message:"Diretor(a):",validate:t=>t?!0:"Obrigat\xF3rio."},{type:"input",name:"anoLancamento",message:"Ano de Lan\xE7amento:",validate:t=>!isNaN(parseInt(t))&&t.length===4?!0:"Ano inv\xE1lido."},{type:"input",name:"genero",message:"G\xEAnero (opcional):"},{type:"input",name:"nota",message:"Nota (0-10, opcional):"},{type:"input",name:"dataAssistido",message:"Data Assistido (DD/MM/AAAA, opcional):",validate:t=>{if(!t)return!0;let s=(0,u.parse)(t,"dd/MM/yyyy",new Date);return(0,u.isValid)(s)?!0:"Formato inv\xE1lido. Use DD/MM/AAAA"}}],e=await n.default.prompt(a),o={id:(0,v.v4)(),titulo:e.titulo,diretor:e.diretor,anoLancamento:parseInt(e.anoLancamento),genero:e.genero||null,nota:e.nota?parseFloat(e.nota):null,dataAssistido:e.dataAssistido||null};await i.create(o),console.log(`
\u2705 Filme cadastrado com sucesso!`)}catch(a){console.error(`
\u274C Erro ao cadastrar o filme:`,a.message)}}async function b(){try{let{id:a}=await n.default.prompt([{type:"input",name:"id",message:"Digite o ID do filme para atualizar:",validate:m=>m?!0:"O ID \xE9 obrigat\xF3rio."}]),e=await i.findById(a);if(!e){console.error(`
\u274C Filme n\xE3o encontrado.`);return}console.log(`
\u{1F504} Atualizando filme (pressione Enter para manter o valor atual):`);let o=[{type:"input",name:"titulo",message:`T\xEDtulo [${e.titulo}]:`,default:e.titulo},{type:"input",name:"diretor",message:`Diretor(a) [${e.diretor}]:`,default:e.diretor},{type:"input",name:"anoLancamento",message:`Ano [${e.anoLancamento}]:`,default:String(e.anoLancamento),validate:m=>m===""||!isNaN(parseInt(m))&&m.length===4?!0:"Inv\xE1lido."},{type:"input",name:"genero",message:`G\xEAnero [${e.genero||"N/A"}]:`,default:e.genero??""},{type:"input",name:"nota",message:`Nota [${e.nota||"N/A"}]:`,default:e.nota?String(e.nota):""},{type:"input",name:"dataAssistido",message:`Data Assistido [${e.dataAssistido||"N/A"}]:`,default:e.dataAssistido??"",validate:m=>{if(!m)return!0;let E=(0,u.parse)(m,"dd/MM/yyyy",new Date);return(0,u.isValid)(E)?!0:"Formato inv\xE1lido. Use DD/MM/AAAA"}}],t=await n.default.prompt(o),s={titulo:t.titulo,diretor:t.diretor,anoLancamento:parseInt(t.anoLancamento),genero:t.genero||null,nota:t.nota?parseFloat(t.nota):null,dataAssistido:t.dataAssistido||null};await i.update(a,s),console.log(`
\u2705 Filme atualizado com sucesso!`)}catch(a){console.error(`
\u274C Erro ao atualizar filme:`,a.message)}}async function I(){try{let{id:a}=await n.default.prompt([{type:"input",name:"id",message:"Digite o ID do filme para deletar:",validate:t=>t?!0:"O ID \xE9 obrigat\xF3rio."}]),e=await i.findById(a);if(!e){console.error(`
\u274C Filme n\xE3o encontrado.`);return}let{confirmar:o}=await n.default.prompt([{type:"confirm",name:"confirmar",message:`Tem certeza que deseja deletar "${e.titulo}"?`,default:!1}]);o?(await i.delete(a),console.log(`
\u{1F5D1}\uFE0F Filme deletado com sucesso!`)):console.log(`
Opera\xE7\xE3o cancelada.`)}catch(a){console.error(`
\u274C Erro ao deletar filme:`,a.message)}}async function z(){let a=[{type:"list",name:"action",message:"O que deseja fazer?",choices:[{name:"\u{1F4CB} Listar todos os filmes",value:"listar"},{name:"\u2795 Cadastrar um novo filme",value:"cadastrar"},{name:"\u{1F50D} Buscar um filme por ID",value:"buscar"},{name:"\u{1F504} Atualizar um filme",value:"atualizar"},{name:"\u{1F5D1}\uFE0F Deletar um filme",value:"deletar"},new n.default.Separator,{name:"\u274C Sair",value:"sair"}]}],{action:e}=await n.default.prompt(a);switch(e){case"listar":await D();break;case"cadastrar":await F();break;case"buscar":await h();break;case"atualizar":await b();break;case"deletar":await I();break;case"sair":console.log(`
\u{1F44B} At\xE9 logo!`),process.exit(0)}let{again:o}=await n.default.prompt([{type:"confirm",name:"again",message:`
Deseja realizar outra opera\xE7\xE3o?`,default:!0}]);o?await z():console.log(`
\u{1F44B} At\xE9 logo!`)}d.program.version("1.0.0").description("Gerenciador de Filmes via CLI");d.program.command("listar").description("Lista todos os filmes").action(D);d.program.command("cadastrar").description("Cadastra um novo filme").action(F);d.program.command("buscar [id]").description("Busca um filme pelo ID (opcional)").action(h);d.program.command("atualizar").description("Atualiza os dados de um filme").action(b);d.program.command("deletar").description("Deleta um filme").action(I);process.argv.length<=2?z():d.program.parse(process.argv);
